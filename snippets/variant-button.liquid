{%- assign swatch_file_extension = 'png' -%}
{% assign productTitle = product.handle %}
<div class="variant-wrapper js" data-type="button">
  <label class="variant__label{% if option.name == 'Default' or option.name == 'Title' %} hidden-label{% endif %}{% unless variant_labels %} hidden-label{% endunless %}"
    for="ProductSelect-{{ section_id }}-{{ product.id }}-option-{{ forloop.index0 }}">
    {{ option.name }}
    {%- if is_color -%}
      <span class="variant__label-info">
        &mdash;
        <span
          id="VariantColorLabel-{{ section_id }}-{{ forloop.index0 }}"
          data-option-index="{{ color_option_index }}">
          {{ option.selected_value }}
        </span>
      </span>
    {%- endif -%}
  </label>
  {%- assign option_index = forloop.index -%}
  <fieldset class="variant-input-wrap"
    name="{{ option.name }}"
    data-index="option{{ option_index }}"
    data-handle="{{ option.name | handleize }}"
    id="ProductSelect-{{ section_id }}-{{ product.id }}-option-{{ forloop.index0 }}">
    <legend class="hide">{{ option.name }}</legend>
    {%- for value in option.values -%}
      {%- assign product_available = true -%}
      {%- if product.options.size == 1 -%}
        {%- assign product_available = product.variants[forloop.index0].available -%}
      {%- endif -%}

      {%- assign val = value | escape -%}
      {% if val == 'Biscuit' and product_available == false and product.title == 'The Zonky 2.0'  %}
        {% assign classhide = 'custom-hide' %}
      {% endif %}

     {% assign domainCode = localization.country.iso_code %}
    
      <div
        class="variant-input {{ classhide }}"
        data-index="option{{ option_index }}"
        data-value="{{ value | escape }}"
        data-variant-id="{{ product.variants[forloop.index0].id }}"
        >
        <input type="radio"
          form="{{ form_id }}"
          {% if option.selected_value == value and product_available %} checked="checked"{% endif %}
          value="{{ value | escape }}"
          data-index="option{{ option_index }}"
          name="{{ option.name }}"
          data-variant-input
          {% if is_color %}data-color-swatch{% endif %}
          class="variant__input-{{ section_id }}{% unless product_available %} disabled{% endunless %}"
          {% if is_color %} data-color-name="{{ value | escape }}"{% endif %}
          {% if is_color %} data-color-index="{{ color_option_index }}"{% endif %}
          id="ProductSelect-{{ section_id }}-{{ product.id }}-option-{{ option.name | handleize }}-{{ value | url_encode }}">
        {%- if is_color -%}
          {%- liquid
            assign color_file_name = value | handle | append: '.' | append: swatch_file_extension
            assign color_image = color_file_name | file_img_url: '50x50' | prepend: 'https:' | split: '?' | first
            assign color_swatch_fallback = value | split: ' ' | last | handle
          -%}
          
          <label
            for="ProductSelect-{{ section_id }}-{{ product.id }}-option-{{ option.name | handleize }}-{{ value | url_encode }}"
            data-attr= "{{ color_swatch_fallback }}"
            class="color-swatch color-swatch--{{ value | handle }}{% unless product_available %} disabled{% endunless %}"
            style="background-color: {{ color_swatch_fallback }};{% if images[color_file_name] != blank %}  background-image: url({{ color_image }});{% endif %}"
          >
            {{ value | escape }}
          </label>
        {%- else -%}
          <label for="ProductSelect-{{ section_id }}-{{ product.id }}-option-{{ option.name | handleize }}-{{ value | url_encode }}"{% unless product_available %} class="disabled"{% endunless %}>{{ value | escape }}</label>
        {%- endif -%}
      </div>
    {%- endfor -%}
  </fieldset>
</div>

<style>

  .custom-hide[data-value="Biscuit"]{
    display: none;
  }
   
</style>

<script>
  let code = {{ domainCode | json }};
  
  let storeName = Shopify.shop;
  let productHandle = {{ productTitle | json }};
  let infourl = `https://api.locationinventory.info/inventory?shop=${storeName}&handle=${productHandle}`;
  let filteredArray = [];
  async function funcName(url) {
    console.log("code",code);
    const response = await fetch(url);
    var data = await response.json();
    let arr = data.variantLocations;
    console.log("array", arr);
    for (let i = 0; i < arr.length; i++) {
      let variant_id = arr[i].variant;
      let locArray = arr[i].inventoryLocations;
      for (let j = 0; j < locArray.length; j++) {
        if (locArray[j].location.country == code && locArray[j].quantity < 1) {
          console.log("matched");
          filteredArray.push(variant_id);
        }
      }
    }
    hideVariant(filteredArray);
  };
  funcName(infourl);

  var colorArray = [];
  async function hideVariant(filteredArray) {

    let varianturl = `/products/${productHandle}.js`;
    const response = await fetch(varianturl);
    let data = await response.json();
    var compareArray = data.variants;
    for (let i = 0; i < filteredArray.length; i++) {
      for (let j = 0; j < compareArray.length; j++) {
        if (filteredArray[i] == compareArray[j].id) {

          colorArray.push(compareArray[j].title);
        }
      }
    }

    for (let i = 0; i < colorArray.length; i++) {
      let colorInputs = document.querySelectorAll('.variant-input');

      for (let j = 0; j < colorInputs.length; j++) {
        if (colorArray[i] == colorInputs[j].outerText) {
          colorInputs[j].children[1].classList.add('disabled');
        }
      }
    }
  };
</script>